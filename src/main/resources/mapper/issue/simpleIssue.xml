<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.issuetracker.domain.issue.IssueViewMapper">

    <!-- LabelResultMap -->
    <resultMap id="LabelResultMap" type="com.issuetracker.domain.label.Label">
        <id property="id" column="LABEL_ID" />
        <result property="description" column="DESCRIPTION" />
        <result property="textColor" column="TEXT_COLOR" />
        <result property="colorCode" column="COLOR_CODE" />
    </resultMap>

    <!-- SimpleIssueResultMap -->
    <resultMap id="SimpleIssueResultMap" type="com.issuetracker.domain.issue.response.SimpleIssue">
        <id property="issueId" column="ISSUE_ID" />
        <result property="memberId" column="ISSUE_MEMBER_ID" />
        <result property="title" column="TITLE" />
        <result property="isOpen" column="IS_OPEN" />
        <result property="milestoneId" column="MILESTONE_ID" />
        <result property="createdAt" column="ISSUE_CREATED_AT" />
        <collection property="labels" ofType="com.issuetracker.domain.label.Label" resultMap="LabelResultMap" javaType="java.util.Set" />
    </resultMap>

    <select id="findAll" resultMap="SimpleIssueResultMap">
        SELECT
            I.ISSUE_ID,
            I.MEMBER_ID AS ISSUE_MEMBER_ID,
            I.TITLE,
            I.IS_OPEN,
            I.MILESTONE_ID,
            I.CREATED_AT AS ISSUE_CREATED_AT,
            L.LABEL_ID,
            L.DESCRIPTION,
            L.TEXT_COLOR,
            L.COLOR_CODE
        FROM ISSUE I
                 LEFT JOIN
             ISSUE_LABEL IL ON I.ISSUE_ID = IL.ISSUE_ID
                 LEFT JOIN
             LABEL L ON IL.LABEL_ID = L.LABEL_ID
    </select>

</mapper>